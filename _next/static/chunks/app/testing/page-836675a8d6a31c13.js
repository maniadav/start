(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[547],{7014:function(e,t,a){Promise.resolve().then(a.bind(a,9552))},9376:function(e,t,a){"use strict";var r=a(5475);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},9552:function(e,t,a){"use strict";a.r(t);var r=a(7437),o=a(2265),n=a(6501),s=a(2807),i=a(6105),l=a(1100),c=a(2464),u=a(8755);t.default=()=>{let[e,t]=(0,o.useState)("");return(0,o.useRef)(null),(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,s.VS)(n.Y.temporaryDB,n.Y.tempVideo);if(e){let a=(0,i.o)(e,"video/webm"),r=URL.createObjectURL(a);t(r)}}catch(e){console.error("Error fetching video from IndexedDB:",e)}})()},[]),(0,r.jsx)("div",{className:"w-screen h-screen",children:(0,r.jsx)(l.p,{show:!0,children:(0,r.jsx)(u.Z,{showFilter:!0,reAttemptUrl:"reAttemptUrl",attempt:0,taskID:c.Ik.PreferentialLookingTask.id})})})}},1100:function(e,t,a){"use strict";a.d(t,{p:function(){return o}});var r=a(7437);let o=e=>{let{show:t,children:a,onRequestClose:o,slideBottom:n=!1,slideTop:s=!1,slideRight:i=!1,slideLeft:l=!1,customStyle:c}=e;return(0,r.jsx)("div",{className:"".concat(t?"inset-0 fixed w-screen  h-screen ease-linear transform transition duration-500 z-50 right-0 top-0 bg-opacity-[0.6] bg-black opacity-100":"inset-0 fixed w-screen  h-screen ease-linear transform transition duration-500 z-50 right-0 top-0 bg-opacity-[0.6] bg-transparent opacity-0\n          ".concat(i&&"translate-x-full"," \n          ").concat(l&&"-translate-x-full","\n          ").concat(n&&"translate-y-full","\n          ").concat(s&&"-translate-y-full")),onClick:()=>o&&o(),children:(0,r.jsx)("div",{className:"".concat(c," relative w-full h-full"),onClick:e=>e.stopPropagation(),children:a})})}},8755:function(e,t,a){"use strict";var r=a(7437),o=a(2265),n=a(3386),s=a(2807),i=a(6105),l=a(9376),c=a(1646),u=a(2635),d=a(6501),h=a(2894),f=a(3896),p=a(2464);t.Z=e=>{let{reAttemptUrl:t,showFilter:a,attempt:g,taskID:y,videoURL:m}=e,k=(0,o.useRef)(null),w=(0,o.useRef)(null),[v,b]=(0,o.useState)(0),[T,S]=(0,o.useState)([0]),[E,x]=(0,o.useState)([0]),[D]=(0,o.useState)(["initial"]),[L,R]=(0,o.useState)(!0),P=["social","nonsocial","social","nonsocial","nonsocial","social"],[j,F]=(0,o.useState)(""),{state:N,dispatch:_}=(0,u.y)(),M=(0,o.useRef)(null),Y=(0,o.useRef)(null),A=(0,l.useRouter)(),C="".concat(f._,"/model/mediapipe/task-vision"),B="".concat(f._,"/model/mediapipe/face-landmark/face_landmarker.task");(0,o.useEffect)(()=>{a&&U().then(()=>{O()})},[a]);let U=async()=>{F("Loading MediaPipe model for gaze detection...");try{var e;let t=await n.n.forVisionTasks(C);try{M.current=await n.jr.createFromOptions(t,{baseOptions:{modelAssetPath:B,delegate:"GPU"},outputFaceBlendshapes:!0,runningMode:"VIDEO",numFaces:1})}catch(e){console.warn("GPU acceleration failed, falling back to CPU:",e),M.current=await n.jr.createFromOptions(t,{baseOptions:{modelAssetPath:B,delegate:"CPU"},outputFaceBlendshapes:!0,runningMode:"VIDEO",numFaces:1})}Y.current=new n.ET(null===(e=w.current)||void 0===e?void 0:e.getContext("2d")),F("Model loaded successfully")}catch(t){let e=t instanceof Error?t.message:String(t);throw F("Error loading model: ".concat(e)),console.error("Detailed error:",t),Error("Unable to load face landmark model")}},O=async()=>{F("Fetching video data...");try{if(m){k.current&&(k.current.src=m,k.current.addEventListener("loadeddata",()=>{I()}));return}let e=await (0,s.VS)(d.Y.temporaryDB,d.Y.tempVideo);if(e){let t=(0,i.o)(e,"video/webm"),a=URL.createObjectURL(t);k.current&&(k.current.src=a,k.current.addEventListener("loadeddata",()=>{I()}))}else F("Couldn't retrieve key ".concat(d.Y.tempVideo," from ").concat(d.Y.temporaryDB," database."))}catch(e){F("Error fetching video"),console.error("Error fetching video:",e)}},I=async()=>{if(F("processing video..."),!k.current||!w.current)return;let e=k.current,t=w.current,a=t.getContext("2d");e.width=720,e.height=400,t.width=720,t.height=400,e.playbackRate=1;try{await e.play()}catch(e){F("Error playing video"),console.error("Error playing video:",e);return}let r=0;e.pause();let o=async()=>{try{let s=e.currentTime;if(r++,a.clearRect(0,0,t.width,t.height),!M.current||"function"!=typeof M.current.detectForVideo)throw Error("faceLandmarkerRef.current model is unavailable");try{var o;let t=M.current.detectForVideo(e,performance.now());if((null==t?void 0:null===(o=t.faceLandmarks)||void 0===o?void 0:o[0])&&Y.current){for(let e of t.faceLandmarks)Y.current.drawConnectors(e,n.jr.FACE_LANDMARKS_TESSELATION,{color:"#C0C0C070",lineWidth:1});let e=t.faceLandmarks[0],a="";if(y==p.Ik.WheelTask.id)a=(0,c.z_)(e),F("Frame: ".concat(r,", Projected Distance: ").concat(a.toFixed(2)," cm at time ").concat(s.toFixed(3),"s"));else{a=(0,c.Kr)(e),F("Looking ".concat(a));let t=parseFloat(s.toFixed(3))||0;F("Frame: ".concat(r,", Looking ").concat(a," at time ").concat(s.toFixed(3),"s"));let o=Math.floor(t/5);if(o<P.length){let e=P[o];"left"===a&&(e="social"===e?"nonsocial":"social"),D.push(e)}}E.push(s),T.push(a||"initial")}}catch(e){console.warn("Frame detection error:",e)}let i=s/e.duration*100;if(b(i),s>=e.duration){let t;(0,h.Sv)(T,"gaze-data"),y==p.Ik.WheelTask.id?(N[y]["attempt".concat(g)],e.duration):t={...N[y]["attempt".concat(g)],gazeDirection:T,gazeTiming:E,gazeVidType:D,videoDuration:e.duration,totalFramesProcessed:r},_({type:"UPDATE_SURVEY_DATA",attempt:g,task:y,data:t}),F("Processing complete! Data saved."),R(!1);return}let l=Math.min(s+.03333333333333333,e.duration);e.currentTime=l}catch(e){console.error("Frame processing error:",e),F("Error processing frame ".concat(r,": ").concat(e))}},s=async()=>{await o()};return e.addEventListener("timeupdate",s),R(!0),e.currentTime=0,()=>{e.removeEventListener("timeupdate",s)}};return(0,r.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center align-middle",children:(0,r.jsxs)("div",{className:"w-full bg-white container max-w-3xl rounded-md",children:[(0,r.jsx)("div",{className:"w-full flex items-start justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600",children:(0,r.jsx)("h3",{className:"text-xl capitalize text-center font-semibold text-gray-900",children:L?"Wait while we process the video.":"Hurray, You have completed the survey!"})}),(0,r.jsxs)("div",{className:"p-4",children:[L&&(0,r.jsx)("p",{id:"eye-direction",className:"text-center text-gray-400 text-base",children:j}),(0,r.jsxs)("div",{className:"w-full h-[300px] max-w-2xl m-auto flex flex-col items-center relative",children:[(0,r.jsx)("video",{className:"absolute h-full w-full max-w-xl rounded-lg bg-gray-800",id:"webcam",ref:k,playsInline:!0,muted:!0,children:"Your browser does not support the video tag."}),(0,r.jsx)("canvas",{className:"absolute h-full w-full rounded-lg",id:"output_canvas",ref:w}),L&&(0,r.jsx)("p",{children:"We are processing the video, please wait..."})]}),L&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-4",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(v,"%")}})})]}),(0,r.jsxs)("div",{className:"w-full flex items-center justify-center p-4 border-t border-gray-200 rounded-b dark:border-gray-600",children:[(0,r.jsx)("button",{disabled:L,onClick:()=>A.push("/survey"),className:"".concat(L?"cursor-not-allowed opacity-50":"cursor-pointer"," capitalize text-white bg-red-800 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:hover:bg-red-700 dark:focus:ring-red-800"),children:"Go to Dashboard"}),t&&(0,r.jsx)("button",{disabled:L,onClick:()=>{!L&&window.location&&(window.location.href=t)},className:"".concat(L?"cursor-not-allowed opacity-50":"cursor-pointer"," ms-3 text-gray-200 bg-gray-800 hover:bg-gray-700 focus:ring-4 focus:outline-none focus:ring-red-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5"),children:"Create New Attempt"})]})]})})}},3896:function(e,t,a){"use strict";a.d(t,{_:function(){return r}});let r="/start"},6501:function(e,t,a){"use strict";a.d(t,{Y:function(){return o},g:function(){return r}});let r={LOGGED_IN_USER:"start_user",MFA_ACCESS_TOKEN:"x-secure-token",MFA_REFRESH_TOKEN:"x-refresh-token",SELECTED_COUNTRY:"psychSelectedCountry",SELECTED_COUNTRY_NAME:"psychSelectedCountryName",SELECTED_VENDORCODE:"psychSelectedVendorCode",SELECTED_LANGUAGE:"psychSelectedLanguageFilter",BASE_URL:"https://x3qrf2-3000.csb.app/api/v1",SURVEY_DATA:"surveyData"},o={surveyDB:"survey",surveyData:"surveyData",useData:"user",tempVideo:"tempVideo",temporaryDB:"temporary"}},2464:function(e,t,a){"use strict";a.d(t,{BQ:function(){return s},Ik:function(){return r},Iq:function(){return u},fM:function(){return n},gq:function(){return d},ho:function(){return i},iS:function(){return o},j6:function(){return l},kg:function(){return c}});let r={MotorFollowingTask:{id:"MotorFollowingTask",title:"Motor Following Task",surveyRoute:"motor-following-task",taskMessage:"Look at this ball moving. You need to drag your finger on the screen and follow the ball's movement. Shall we stop it?",taskEndMessage:"You have completed the Motor Following Task. You can now go back to the survey dashboard, or start a new task."},BubblePoppingTask:{id:"BubblePoppingTask",title:"Bubble Popping Task",surveyRoute:"bubble-popping-task",taskMessage:"Watch, I'm going to pop these bubblesâ€”pop, pop, pop! Now it's your turn to pop them. Shall we start?",taskEndMessage:"You have completed the Bubble Popping Task. You can now go back to the survey dashboard, or start a new task."},ButtonTask:{id:"ButtonTask",title:"Button Task",surveyRoute:"button-task",taskMessage:"There are two buttons, each containing a video. Show both videos to the child and press 'start' once the child is ready.",taskEndMessage:"You have completed the Button Task. Would you like to go back or start the next test?"},WheelTask:{id:"WheelTask",title:"Wheel Task",surveyRoute:"wheel-task",taskMessage:"Look at this spinning wheel. You can watch it for as long as you like. If you want to stop it, simply press the red button. Shall we stop it?",taskEndMessage:"You have completed the Wheel Task. You can now return to the survey dashboard, or start a new task."},SynchronyTask:{id:"SynchronyTask",title:"Synchrony Task",surveyRoute:"synchrony-task",taskMessage:"Look at this drum. Listen to his rhythm and try to tap your drum in sync with him. Tap along with the character.",taskEndMessage:"You have completed the Synchrony Task. You can now go back to the survey dashboard, or start a new task."},LanguageSamplingTask:{id:"LanguageSamplingTask",title:"Language Sampling Task",surveyRoute:"language-sampling-task",taskMessage:"Look at the picture. There are many different things happening. Explain the events to the child. Can you describe what is happening in the video?",taskEndMessage:"You have completed the Language Sampling Task. You can now go back to the survey dashboard, or start a new task."},DelayedGratificationTask:{id:"DelayedGratificationTask",title:"Delayed Gratification Task",surveyRoute:"delayed-gratification-task",taskMessage:"Look at these rewards (show the rewards). If you wait until this finishes (point to the wheel icon), you can have three rewards. But if you don't wait and press the yellow star (point to the yellow star), you'll only get one reward.",taskEndMessage:"You have completed the Delayed Gratification Task. You can now go back to the survey dashboard, or start a new task."},PreferentialLookingTask:{id:"PreferentialLookingTask",title:"Preferential Looking Task",surveyRoute:"preferential-looking-task",taskMessage:"I would like to show you something on my tablet. Watch these videos and try to remain still while keeping your eyes on the screen.",taskEndMessage:"You have completed the Preferential Looking Task. You can now go back to the survey dashboard, or start a new task."}},o=r.MotorFollowingTask,n=r.BubblePoppingTask,s=r.ButtonTask,i=r.WheelTask,l=r.SynchronyTask,c=r.LanguageSamplingTask,u=r.DelayedGratificationTask,d=r.PreferentialLookingTask},6105:function(e,t,a){"use strict";a.d(t,{l:function(){return r},o:function(){return o}});let r=e=>new Promise((t,a)=>{let r=new FileReader;r.onloadend=()=>{r.result?t(r.result.split(",")[1]):a("Failed to convert file to base64")},r.onerror=()=>{a("File reading error")},r.readAsDataURL(e)});function o(e,t,a){let r=atob(e.split(",")[1]||e),o=r.length,n=new Uint8Array(o);for(let e=0;e<o;e++)n[e]=r.charCodeAt(e);let s=new Blob([n],{type:t});if(!a){let e=t.split("/")[1]||"file";a="file.".concat(e)}return new File([s],a,{type:t})}},2894:function(e,t,a){"use strict";a.d(t,{Sv:function(){return r}});let r=(e,t)=>{let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=window.URL.createObjectURL(a),o=document.createElement("a");o.setAttribute("href",r),o.setAttribute("download",t),o.click(),window.URL.revokeObjectURL(r)}},2635:function(e,t,a){"use strict";a.d(t,{SurveyProvider:function(){return g},y:function(){return y}});var r=a(7437),o=a(6501);let{childID:n,childDOB:s,childGender:i,observerId:l}=(0,a(7727).jy)(o.g.LOGGED_IN_USER,!0)||{},c=e=>({assestment_id:e,noOfAttempt:0,attempt1:{},attempt2:{},attempt3:{},userID:""});c("BubblePoppingTask"),c("MotorFollowingTask"),c("ButtonTask");let u=["BubblePoppingTask","DelayedGratificationTask","MotorFollowingTask","ButtonTask","SynchronyTask","LanguageSamplingTask","WheelTask","PreferentialLookingTask"].reduce((e,t)=>(e[t]={...c(t),userID:n,userDOB:s,userGender:i,observerId:l},e),{});var d=a(2807),h=a(2265);let f=(0,h.createContext)(void 0),p=(e,t)=>{switch(t.type){case"SET_SURVEY_DATA":return{...e,...t.payload};case"UPDATE_SURVEY_DATA":var a;return{...e,[t.task]:{...e[t.task],noOfAttempt:t.attempt,["attempt".concat(t.attempt)]:{...null===(a=e[t.task])||void 0===a?void 0:a["attempt".concat(null==t?void 0:t.attempt)],...t.data}}};default:return{...e}}},g=e=>{let{children:t}=e,[a,n]=(0,h.useReducer)(p,u),[s,i]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{(async()=>{try{let e=await (0,d.VS)(o.Y.surveyDB,o.Y.surveyData);e&&!s&&n({type:"SET_SURVEY_DATA",payload:e})}catch(e){console.error("Failed to load persisted survey state:",e)}finally{i(!0)}})()},[s]),(0,h.useEffect)(()=>{s&&(async()=>{try{await (0,d.TP)(o.Y.surveyDB,o.Y.surveyData,a)}catch(e){console.error("Failed to save survey state:",e)}})()},[a,s]),(0,r.jsx)(f.Provider,{value:{state:a,dispatch:n},children:t})},y=()=>{let e=(0,h.useContext)(f);if(!e)throw Error("useSurveyContext must be used within a SurveyProvider");return e}},2807:function(e,t,a){"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise((a,r)=>{let o=indexedDB.open(e,t);o.onsuccess=()=>a(o.result),o.onerror=()=>r("Failed to open database: ".concat(e)),o.onupgradeneeded=()=>{let e=o.result;e.objectStoreNames.contains("data")||e.createObjectStore("data")}})}async function o(e,t,a){try{let o=await r(e),n=o.transaction("data","readwrite");n.objectStore("data").put(a,t),n.oncomplete=()=>{o.close()},n.onerror=t=>{console.error("Transaction error in ".concat(e,":"),t)}}catch(t){console.error("Error setting value in ".concat(e,":"),t)}}async function n(e,t){try{let a=await r(e);return new Promise((r,o)=>{let n=a.transaction("data","readonly").objectStore("data").get(t);n.onsuccess=()=>{let e=n.result;r(e),a.close()},n.onerror=()=>{o("Failed to retrieve data from ".concat(e)),a.close()}})}catch(t){return console.error("Error getting value from ".concat(e,":"),t),null}}async function s(e,t){try{let a=await r(e),o=a.transaction("data","readwrite");o.objectStore("data").delete(t),o.oncomplete=()=>a.close()}catch(t){console.error("Error removing value from ".concat(e,":"),t)}}a.d(t,{TP:function(){return o},VS:function(){return n},pV:function(){return s}}),a(6501)},7727:function(e,t,a){"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("localStorage"in window)try{let a=window.localStorage.getItem(e);if(!a)return null;if(!t)return a;if(a)return JSON.parse(a)}catch(e){}return null}function o(e,t,a){if("localStorage"in window)try{a?window.localStorage.setItem(e,JSON.stringify(t)):"string"==typeof t&&window.localStorage.setItem(e,t)}catch(e){console.log(e)}return null}function n(){"localStorage"in window&&window.localStorage.clear()}a.d(t,{jy:function(){return r},pO:function(){return n},uN:function(){return o}})},1646:function(e,t,a){"use strict";function r(e){if(!(null==e?void 0:e[468])||!(null==e?void 0:e[473])||!(null==e?void 0:e[33])||!(null==e?void 0:e[263]))return"Invalid landmarks";let t=e[468],a=e[473],r=e[33],o=e[263];function n(e,t){let a=e.x-t.x,r=e.y-t.y;return Math.sqrt(a*a+r*r)}let s=n(t,r),i=n(a,o);return s>i?"left":i>s?"right":"center"}a.d(t,{Kr:function(){return r},z_:function(){return o}});let o=e=>{if(!(null==e?void 0:e[33])||!(null==e?void 0:e[263]))return 0;let t=null==e?void 0:e[33],a=null==e?void 0:e[263];return Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))}}},function(e){e.O(0,[386,971,522,744],function(){return e(e.s=7014)}),_N_E=e.O()}]);