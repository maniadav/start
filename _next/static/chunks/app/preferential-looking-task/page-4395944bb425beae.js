(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{6482:function(e,t,s){Promise.resolve().then(s.bind(s,3147))},3147:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var r=s(7437),n=s(2265),l=s(3949),a=s(9376),i=s(3991),u=s(2635),c=s(2762),d=s(2881),o=s(6849),m=s(6886),h=s(2464),f=s(3896),v=e=>{let{isSurvey:t=!1}=e,[s,l]=(0,n.useState)(!1),[v,p]=(0,n.useState)(!1),[j,x]=(0,n.useState)(null),[g,k]=(0,n.useState)({}),{windowSize:w,deviceType:S}=(0,c.Z)(),{state:_,dispatch:b}=(0,u.y)(),T=parseInt((0,a.useSearchParams)().get("attempt")||"0"),y=T<3?"".concat(f._,"/").concat(h.gq.surveyRoute,"?attempt=").concat(T+1):null,{startVidRecording:E,stopVidRecording:N,CameraPermissionPopupUI:P}=(0,o.Z)(),Z=(0,n.useRef)(null),[C,q]=(0,n.useState)(3e4);(0,n.useEffect)(()=>{let e=Z.current;return e&&(e.onloadedmetadata=()=>{q(1e3*e.duration)}),()=>{e&&(e.onloadedmetadata=null)}},[]),(0,n.useEffect)(()=>{t&&A()},[t]),(0,n.useEffect)(()=>{(null==j?void 0:j.isTimeOver)&&!v&&(F(j),p(!0))},[v,j]);let A=async()=>{await E(),R()},O=(0,n.useRef)(),R=()=>{let{endTimePromise:e,stopTimer:t}=(0,i.H)(C);return O.current=t,e.then(x),()=>{O.current&&O.current()}},D=(0,n.useCallback)(()=>{if(O.current)return O.current()},[]),F=(0,n.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(await N(),l(e=>!e),k(t=>{let r={...t,timrLimit:(null==e?void 0:e.timeLimit)||"",endTime:(null==e?void 0:e.endTime)||"",startTime:(null==e?void 0:e.startTime)||"",closedWithTimeout:(null==e?void 0:e.isTimeOver)||!1,screenHeight:w.height,screenWidth:w.width,closedMidWay:s,deviceType:S};return b({type:"UPDATE_SURVEY_DATA",attempt:T,task:h.gq.id,data:r}),r}))},[t,j,T,s]);return(0,r.jsxs)("div",{className:"relative w-screen h-screen overflow-hidden",children:[P,t&&(0,r.jsx)(d.Z,{handlePressAction:()=>{F(D(),!0)}}),(0,r.jsx)("div",{className:"w-screen h-screen relative bg-black",children:(0,r.jsx)("video",{ref:Z,className:"absolute top-0 left-0 w-full h-full object-fit",autoPlay:!0,muted:!0,children:(0,r.jsx)("source",{src:"".concat(f._,"/video/").concat(t?"start-plt.mp4":"plt-sample.mp4"),type:"video/mp4"})})}),t&&(0,r.jsx)(m.Z,{showFilter:s,onProcessComplete:l,reAttemptUrl:y,attempt:T,taskID:h.gq.id})]})},p=s(1522);let j=(0,n.createContext)(void 0),x=e=>{let{children:t}=e,[s,l]=(0,n.useState)([]);return(0,r.jsx)(j.Provider,{value:{gazeData:s,setGazeData:l},children:t})};var g=s(8422);let k=()=>{let[e,t]=(0,n.useState)(!1),s=()=>{t(!e)};return(0,r.jsx)(r.Fragment,{children:e?(0,r.jsx)(g.Z,{isFullScreen:e,children:(0,r.jsx)(v,{isSurvey:e})}):(0,r.jsxs)("div",{className:"w-full h-full overflow-hidden",children:[(0,r.jsx)(l.Z,{taskName:h.gq.title,taskMessage:h.gq.taskMessage,handleStartGame:()=>s()}),(0,r.jsx)(v,{})]})})};function w(){return(0,r.jsx)(p.Z,{children:(0,r.jsx)(x,{children:(0,r.jsx)(k,{})})})}}},function(e){e.O(0,[699,972,145,845,386,75,583,334,971,522,744],function(){return e(e.s=6482)}),_N_E=e.O()}]);