(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{6482:function(e,t,r){Promise.resolve().then(r.bind(r,2324))},2324:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var n=r(7437),i=r(2265),l=r(1789),s=r(6463),a=r(5345),o=r(2462),u=r(8002),c=r(232),d=r(1647),m=r(9891),h=r(2978),w=e=>{let{showFilter:t,reAttemptUrl:r,taskID:i,attempt:l}=e;return(0,s.useRouter)(),console.log({showFilter:t}),(0,n.jsx)(m.p,{show:t,slideBottom:!0,children:(0,n.jsx)("div",{className:"fixed top-0 right-0 left-0 botom-0  w-full h-full flex items-center align-middle justify-center align-center overflow-y-auto bg-black",children:(0,n.jsx)("div",{className:"relative p-4 w-full max-w-xl max-h-full",children:(0,n.jsx)("div",{className:"relative bg-white rounded-lg shadow ",children:(0,n.jsx)("div",{className:"p-4 md:p-5 space-y-4",children:(0,n.jsx)(h.Z,{reAttemptUrl:r,showFilter:t,attempt:l,taskID:i})})})})})})},f=r(8582),v=r(1334),p=e=>{let{isSurvey:t=!1}=e,[r,l]=(0,i.useState)(!1),[m,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(null),[x,b]=(0,i.useState)({}),{windowSize:y,deviceType:j}=(0,u.Z)(),{state:k,dispatch:T}=(0,o.y)(),E=parseInt((0,s.useSearchParams)().get("attempt")||"0"),S=E<3?"".concat(v._,"/").concat(f.gq.surveyRoute,"?attempt=").concat(E+1):null,{startVidRecording:F,stopVidRecording:R}=(0,d.Z)(),N=(0,i.useRef)(null),[q,C]=(0,i.useState)(3e4);(0,i.useEffect)(()=>{let e=N.current;return e&&(e.onloadedmetadata=()=>{C(1e3*e.duration)}),()=>{e&&(e.onloadedmetadata=null)}},[]),(0,i.useEffect)(()=>{t&&Z()},[t]),(0,i.useEffect)(()=>{(null==p?void 0:p.isTimeOver)&&!m&&(z(p),h(!0))},[m,p]);let Z=async()=>{await F(),P()},D=(0,i.useRef)(),P=()=>{let{endTimePromise:e,stopTimer:t}=(0,a.H)(q);return D.current=t,e.then(g),()=>{D.current&&D.current()}},_=(0,i.useCallback)(()=>{if(D.current)return D.current()},[]),z=(0,i.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(await R(),l(e=>!e),b(t=>{let n={...t,timrLimit:(null==e?void 0:e.timeLimit)||"",endTime:(null==e?void 0:e.endTime)||"",startTime:(null==e?void 0:e.startTime)||"",closedWithTimeout:(null==e?void 0:e.isTimeOver)||!1,screenHeight:y.height,screenWidth:y.width,closedMidWay:r,deviceType:j};return T({type:"UPDATE_SURVEY_DATA",attempt:E,task:f.gq.id,data:n}),n}))},[t,p,E,r]);return(0,n.jsxs)("div",{className:"relative w-screen h-screen overflow-hidden",children:[t&&(0,n.jsx)(c.Z,{handlePressAction:()=>{z(_(),!0)}}),(0,n.jsx)("div",{className:"w-screen h-screen relative bg-black",children:(0,n.jsx)("video",{ref:N,className:"absolute top-0 left-0 w-full h-full object-fit",autoPlay:!0,muted:!0,children:(0,n.jsx)("source",{src:"".concat(v._,"/video/plt.mp4"),type:"video/mp4"})})}),t&&(0,n.jsx)(w,{showFilter:r,onProcessComplete:l,reAttemptUrl:S,attempt:E,taskID:f.gq.id})]})},g=r(8214);let x=(0,i.createContext)(void 0),b=e=>{let{children:t}=e,[r,l]=(0,i.useState)([]);return(0,n.jsx)(x.Provider,{value:{gazeData:r,setGazeData:l},children:t})};var y=r(872);let j=()=>{let[e,t]=(0,i.useState)(!1),r=()=>{t(!e)};return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(y.Z,{isFullScreen:e,children:(0,n.jsx)(p,{isSurvey:e})}):(0,n.jsxs)("div",{className:"w-full h-full overflow-hidden",children:[(0,n.jsx)(l.Z,{taskName:f.gq.title,taskMessage:f.gq.taskMessage,handleStartGame:()=>r()}),(0,n.jsx)(p,{})]})})};function k(){return(0,n.jsx)(g.Z,{children:(0,n.jsx)(b,{children:(0,n.jsx)(j,{})})})}},232:function(e,t,r){"use strict";var n=r(7437),i=r(2265);t.Z=e=>{let{handlePressAction:t}=e,[r,l]=(0,i.useState)(null),s=e=>{r&&r!==e?(console.log("close action will handle"),t(),l(null)):(l(e),setTimeout(()=>{l(null)},5e3))};return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"z-50 fixed right-0 top-0 p-3 cursor-pointer w-16 h-16 ",onClick:()=>s("top")}),(0,n.jsx)("div",{className:"z-50 fixed right-0 bottom-0 p-3 cursor-pointer w-16 h-16",onClick:()=>s("bottom")})]})}},872:function(e,t,r){"use strict";var n=r(7437),i=r(2265);t.Z=e=>{let{isFullScreen:t,children:r}=e,l=(0,i.useRef)(null);(0,i.useEffect)(()=>{t?s():a()},[t]);let s=async()=>{try{if(l.current){let e=l.current;e.requestFullscreen?await e.requestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.msRequestFullscreen&&await e.msRequestFullscreen()}}catch(e){console.error("Error trying to enter fullscreen mode:",e)}},a=async()=>{try{document.fullscreenElement&&(document.exitFullscreen?await document.exitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen())}catch(e){console.error("Error trying to exit fullscreen mode:",e)}};return(0,n.jsx)("div",{ref:l,style:{height:"100vh",width:"100vw",backgroundColor:"#f0f0f0"},children:r})}},1647:function(e,t,r){"use strict";var n=r(7257),i=r(3972),l=r(1064),s=r(2265);t.Z=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)([]),[r,a]=(0,s.useState)(!1),[o,u]=(0,s.useState)(null);return{isRecording:r,startVidRecording:async()=>{try{let r=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});u(r),e.current=new MediaRecorder(r,{mimeType:"video/webm"}),e.current.ondataavailable=e=>{e.data.size>0&&t.current.push(e.data)},e.current.start(),a(!0)}catch(e){console.error("Error accessing media devices.",e),alert("Camera access is required for this task"),window.location.reload()}},stopVidRecording:()=>new Promise(r=>{e.current?(e.current.stop(),e.current.onstop=async()=>{let e=new Blob(t.current,{type:"video/webm"});try{let s=new File([e],"video.webm",{type:"video/webm"}),c=await (0,i.l)(s);await (0,l.TP)(n.Y.temporaryDB,n.Y.tempVideo,c),t.current=[],a(!1),o&&(o.getTracks().forEach(e=>e.stop()),u(null)),r(c)}catch(e){console.error("Error converting video to base64:",e),r(null)}}):r(null)})}}},8002:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(2265);function i(){let[e,t]=(0,n.useState)({width:void 0,height:void 0}),[r,i]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{let e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return"undefined"!=typeof navigator&&i(navigator.userAgent),window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]);let l="number"==typeof(null==e?void 0:e.width)&&(null==e?void 0:e.width)<768,s="number"==typeof(null==e?void 0:e.width)&&(null==e?void 0:e.width)>=768;return{windowSize:e,isMobile:l,isDesktop:s,deviceType:r}}},5345:function(e,t,r){"use strict";r.d(t,{H:function(){return i}});let n=e=>new Date(new Date(e).getTime()).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",hour12:!0}),i=e=>{let t;let r=Date.now(),i=n(r);return{endTimePromise:new Promise(r=>{t=setTimeout(()=>{r(Date.now())},e)}).then(t=>{let l=t-r;return{startTime:i,endTime:n(t),timeLimit:e,isTimeOver:l>=e,timeTaken:l}}),stopTimer:()=>{clearTimeout(t);let l=Date.now(),s=l-r;return{startTime:i,endTime:n(l),timeLimit:e,isTimeOver:s>=e,timeTaken:s}}}}}},function(e){e.O(0,[231,812,398,642,978,971,275,744],function(){return e(e.s=6482)}),_N_E=e.O()}]);